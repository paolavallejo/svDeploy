<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <!--<meta name=description content="This site was generated with Anima. www.animaapp.com"/>-->
    <!-- <link rel="shortcut icon" type=image/png href="https://animaproject.s3.amazonaws.com/home/favicon.png" /> -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0" />
    <link rel="shortcut icon" type="image/png" href="https://animaproject.s3.amazonaws.com/home/favicon.png" />
    <meta name="og:type" content="website" />
    <meta name="twitter:card" content="photo" />

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    {% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'sasvar_app/css/escaneo.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'sasvar_app/css/styleguide.css' %}" />
    <link rel="stylesheet" type="text/css" href="{% static 'sasvar_app/css/globals.css' %}" />
  </head>
  <body style="margin: 0; background: #fdfdfd">
    <input type="hidden" id="anPageName" name="page" value="escaneo" />
    <div class="container-center-horizontal">
      <div class="escaneo screen">
        <div class="overlap-group2">
        <!-- <video id="video" width="640" height="480" autoplay></video> -->
          <div class="group-7">
            <img class="photo-icon" src="{% static 'sasvar_app/img/photo-icon@1x.png' %}" alt="photo icon" />
          </div>
          <div class="rectngulo-44 rectngulo">
          </div>
          <div class="grupo-50 grupo">
          <!-- <video id="video" width="640" height="480" autoplay></video> -->
            <div class="grupo-6 grupo">
              <img class="trazado" src="{% static 'sasvar_app/img/trazado-2@1x.png' %}" alt="Trazado 2" />
              <img class="trazado" src="{% static 'sasvar_app/img/trazado-3@1x.png' %}" alt="Trazado 3" />
            </div>
            <div class="grupo-7 grupo">
              <img class="trazado-2" src="{% static 'sasvar_app/img/trazado-2-1@1x.png' %}" alt="Trazado 2" />
              <img class="trazado" src="{% static 'sasvar_app/img/trazado-3-1@1x.png' %}" alt="Trazado 3" />
            </div>
          </div>
          <div class="textos-principales">
            <video id="video" width="350" height="300" autoplay></video>
            <p class="asegrate-de-enfocar montserrat-normal-log-cabin-18px">
              Asegúrate de enfocar bien tu residuo y de que el entorno esté bien iluminado.
            </p>
          </div>
          <!--<a href="{% url 'carga' %}">-->
          <form action="{% url 'guardar_imagen' %}" method="POST" enctype="multipart/form-data">
            {% csrf_token %}
              <div class="botn-accin">
                <input type="text" id="name-image" value="capture" name="name" hidden/>
                <input type="file" id="input-image" name="image" accept="image/png, image/jpeg" />
                <div class="textos-principales-1 textos-principales-3">
                  <div class="tomar-captura montserrat-bold-shark-18px" id="captureButton">Tomar captura</div>
                </div>    
                <div class="continuar continuar-2">
                  <div class="flecha flecha-2">
                    <div class="lnea-container">
                      <img class="lnea-1" src="{% static 'sasvar_app/img/l-nea-1-10@1x.png' %}" alt="Lnea 1" />
                      <img class="lnea-2" src="{% static 'sasvar_app/img/l-nea-2-10@1x.png' %}" alt="Lnea 2" />
                      <img class="lnea-3" src="{% static 'sasvar_app/img/l-nea-3-10@1x.png' %}" alt="Lnea 3" />
                      <img class="lnea-5" src="{% static 'sasvar_app/img/l-nea-5-10@1x.png' %}" alt="Lnea 5" />
                    </div>
                  </div>
                </div>
                <button type="submit">enviar</button>
              </div>
          </form>
          <div class="rectngulo-49 rectngulo"></div>
          <div class="barra-men">
            <a href="{% url 'categorias' %}"> <div class="reading-open-book"></div></a>
            <div class="botn-de-escaneo">
              <div class="overlap-group">
                <div class="cono-escaneo"></div>
              </div>
            </div>
            <a href="{% url 'inicio' %}"> <div class="web-page-home"></div></a>
          </div>
          <a href="{% url 'inicio' %}">
            <div class="componente-24-29">
              <div class="continuar-2">
                <div class="flecha-2">
                  <div class="lnea-container-1">
                    <img class="lnea-1-1" src="{% static 'sasvar_app/img/l-nea-1-10@1x.png' %}" alt="Lnea 1" />
                    <img class="lnea-2-1" src="{% static 'sasvar_app/img/l-nea-2-10@1x.png' %}" alt="Lnea 2" />
                    <img class="lnea-3-1" src="{% static 'sasvar_app/img/l-nea-3-11@1x.png' %}" alt="Lnea 3" />
                    <img class="lnea-5-1" src="{% static 'sasvar_app/img/l-nea-5-11@1x.png' %}" alt="Lnea 5" />
                  </div>
                </div>
              </div>
              <div class="textos-principales-2 textos-principales-3">
                <div class="atrs montserrat-normal-log-cabin-18px">Atrás</div>
              </div>
            </div></a
          >
          <div class="ayuda">
            <div class="texto-pequeo"><div class="ayuda-1 montserrat-normal-shark-16px">Ayuda</div></div>
            <div class="overlap-group1">
              <div class="text-6 arialroundedmt-bold-shark-20px">?</div>
              <img class="trazado-1059" src="{% static 'sasvar_app/img/trazado-1059-1@1x.png' %}" alt="Trazado 1059" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      window.addEventListener("DOMContentLoaded", nombrarImagen);
      function nombrarImagen() {
        // Formatea la fecha en "ddmmaa"
        var fecha = new Date();
        var dia = fecha.getDate().toString().padStart(2, '0'); // Obtener el día con ceros a la izquierda
        var mes = (fecha.getMonth() + 1).toString().padStart(2, '0'); // Obtener el mes con ceros a la izquierda
        var anio = fecha.getFullYear().toString().slice(2); // Obtener los últimos dos dígitos del año
        var fechaFormateada = dia + mes + anio;

        //generar numero aleatorio
        var numeroAleatorio = Math.floor(100000 + Math.random() * 900000);
        // Obtener elementos HTML
        var inputNombre = document.getElementById("name-image");
        inputNombre.value = `${numeroAleatorio}_${fechaFormateada}.jpg`;
      }

// Función para tomar una captura de la cámara
function captureImage() {
    const canvas = document.createElement('canvas');
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    const ctx = canvas.getContext('2d');
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);

    // Convertir la imagen a formato JPEG
    const dataURL = canvas.toDataURL('image/jpeg');

    // Generar un nombre de archivo único basado en la fecha y hora actual
    const timestamp = new Date().getTime();
    const nombreArchivo = `captura_${timestamp}.jpg`;

    // Crear un objeto FormData para enviar la imagen al servidor
    const formData = new FormData();
    formData.append('image', dataURL);
    formData.append('nombre_archivo', nombreArchivo);

    // Realizar una solicitud POST para guardar la imagen en Django
    fetch('/guardar_imagen/', {
      method: 'POST',
      body: formData,
      })
        .then(response => {
            if (response.ok) {
                alert('Imagen guardada exitosamente.');
            } else {
                alert('Error al guardar la imagen.');
            }
        })
        .catch(error => {
            console.error('Error al enviar la imagen al servidor: ', error);
        });
    

    // Crear un enlace de descarga
    const downloadLink = document.createElement('a');
    downloadLink.href = dataURL;
    downloadLink.download = 'captura.jpg'; // Nombre del archivo de descarga

    // Hacer clic en el enlace para iniciar la descarga
    downloadLink.click();
    
  }
    </script>

  </body>
</html>
